{% extends "base.html" %}

{% block title %}Kisan Bot - Kisan Dhristi{% endblock %}

{% block content %}
<style>
/* Custom Scrollbar Styles */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--primary, #4f46e5);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark, #3730a3);
}

/* For Firefox */
* {
    scrollbar-width: thin;
    scrollbar-color: var(--primary, #4f46e5) rgba(255, 255, 255, 0.05);
}

/* Font support for Indian languages */
select, option {
    font-family: 'Noto Sans', 'Arial Unicode MS', sans-serif;
    font-size: 16px; /* Ensure readability */
}

/* Ensure proper rendering for RTL languages like Urdu */
select[dir="rtl"], option[dir="rtl"] {
    direction: rtl;
}
</style>

<meta charset="UTF-8">

<section id="kisan-bot" class="section">
    <div class="section-header">
        <h2>Kisan Bot</h2>
        <p>Your AI-powered agricultural assistant</p>
    </div>
    <div class="card-grid">
        <div class="card">
            <div class="card-icon">
                <svg width="30" height="30" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            <h3>Upload Image</h3>
            <p>Take or upload a photo of the affected crop leaf for instant analysis</p>
        </div>
        <div class="card">
            <div class="card-icon">
                <svg width="30" height="30" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </div>
            <h3>Get Diagnosis</h3>
            <p>Receive instant AI-powered disease identification and severity assessment</p>
        </div>
        <div class="card">
            <div class="card-icon">
                <svg width="30" height="30" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <h3>Follow Treatment</h3>
            <p>Implement recommended treatment steps in your preferred language</p>
        </div>
    </div>
    <div style="text-align: center; margin-top: 60px;">
        <form action="{{ url_for('kisan_bot') }}" method="POST" enctype="multipart/form-data" class="upload-form">
            <div class="file-upload-container">
                <label for="crop-image" class="file-upload-label">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"/>
                    </svg>
                    <span id="file-label-text">Upload Crop Image</span>
                    <span class="file-upload-icon">üìÅ</span>
                </label>
                <input type="file" id="crop-image" name="crop-image" accept="image/*" required class="file-input">
            </div>

            <div class="text-input-container">
                <label for="query" class="input-label">
                    Ask a Question (Optional)
                </label>
                <input type="text" id="query" name="query" placeholder="E.g., What disease is this?" class="text-input" value="">
            </div>
            
            <div class="text-input-container">
                <label for="language" class="input-label">
                    Select Language
                </label>
                <select id="language" name="language" class="text-input" required>
                    <option style="background-color: #111;" value="English" {% if language == 'English' %}selected{% endif %}>English</option>
                    <option style="background-color: #111;" value="Assamese" {% if language == 'Assamese' %}selected{% endif %}>‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ</option>
                    <option style="background-color: #111;" value="Bengali" {% if language == 'Bengali' %}selected{% endif %}>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                    <option style="background-color: #111;" value="Bodo" {% if language == 'Bodo' %}selected{% endif %}>‡§¨‡•ã‡§∞‡•ã‡§Ç</option>
                    <option style="background-color: #111;" value="Dogri" {% if language == 'Dogri' %}selected{% endif %}>‡§°‡•ã‡§ó‡§∞‡•Ä</option>
                    <option style="background-color: #111;" value="Gujarati" {% if language == 'Gujarati' %}selected{% endif %}>‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                    <option style="background-color: #111;" value="Hindi" {% if language == 'Hindi' %}selected{% endif %}>‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                    <option style="background-color: #111;" value="Kannada" {% if language == 'Kannada' %}selected{% endif %}>‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                    <option style="background-color: #111;" value="Kashmiri" {% if language == 'Kashmiri' %}selected{% endif %}>⁄©Ÿ≤ÿ¥Ÿèÿ±</option>
                    <option style="background-color: #111;" value="Konkani" {% if language == 'Konkani' %}selected{% endif %}>‡§ï‡•ã‡§Ç‡§ï‡§£‡•Ä</option>
                    <option style="background-color: #111;" value="Maithili" {% if language == 'Maithili' %}selected{% endif %}>‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä</option>
                    <option style="background-color: #111;" value="Malayalam" {% if language == 'Malayalam' %}selected{% endif %}>‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                    <option style="background-color: #111;" value="Manipuri" {% if language == 'Manipuri' %}selected{% endif %}>‡¶Æ‡ßà‡¶§‡ßà‡¶≤‡ßã‡¶®‡ßç</option>
                    <option style="background-color: #111;" value="Marathi" {% if language == 'Marathi' %}selected{% endif %}>‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                    <option style="background-color: #111;" value="Nepali" {% if language == 'Nepali' %}selected{% endif %}>‡§®‡•á‡§™‡§æ‡§≤‡•Ä</option>
                    <option style="background-color: #111;" value="Odia" {% if language == 'Odia' %}selected{% endif %}>‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
                    <option style="background-color: #111;" value="Punjabi" {% if language == 'Punjabi' %}selected{% endif %}>‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
                    <option style="background-color: #111;" value="Sanskrit" {% if language == 'Sanskrit' %}selected{% endif %}>‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç</option>
                    <option style="background-color: #111;" value="Santali" {% if language == 'Santali' %}selected{% endif %}>·±•·±ü·±±·±õ·±ü·±≤·±§</option>
                    <option style="background-color: #111;" value="Sindhi" {% if language == 'Sindhi' %}selected{% endif %}>ÿ≥ŸÜ⁄åŸä</option>
                    <option style="background-color: #111;" value="Tamil" {% if language == 'Tamil' %}selected{% endif %}>‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                    <option style="background-color: #111;" value="Telugu" {% if language == 'Telugu' %}selected{% endif %}>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                    <option style="background-color: #111;" value="Urdu" {% if language == 'Urdu' %}selected{% endif %}>ÿßÿ±ÿØŸà</option>
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary btn-large">Start Diagnosis</button>
        </form>
        
        {% if diagnosis %}
<div class="card diagnosis-card">
    <h3 style="font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; color: var(--text-primary); margin-bottom: 15px;">Diagnosis Result</h3>
    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; border-left: 4px solid var(--primary);">
        <p style="color: var(--text-primary); line-height: 1.8; white-space: pre-wrap; margin: 0; font-size: 1.1rem;">{{ diagnosis }}</p>
    </div>
    {% if image_path %}
    <div style="text-align: center; margin-top: 25px;">
        <img src="{{ url_for('static', filename=image_path) }}" 
             alt="Uploaded Crop Image" 
             class="uploaded-image"
             onerror="this.style.display='none'; console.log('Image failed to load');">
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">Your uploaded image</p>
    </div>
    {% endif %}
</div>
{% endif %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('crop-image');
    const fileLabel = document.querySelector('.file-upload-label');
    const fileLabelText = document.getElementById('file-label-text');
    
    fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const fileName = this.files[0].name;
            fileLabelText.textContent = fileName.length > 25 ? fileName.substring(0, 25) + '...' : fileName;
            fileLabel.classList.add('has-file');
        } else {
            fileLabelText.textContent = 'Upload Crop Image';
            fileLabel.classList.remove('has-file');
        }
    });
});
</script>
{% endblock %}