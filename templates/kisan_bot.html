{% extends "base.html" %}

{% block title %}Kisan Bot - Kisan Dhristi{% endblock %}

{% block content %}
<!-- Kisan Bot Section -->
<section id="kisan-bot" class="section">
    <div class="section-header">
        <h2>Kisan Bot</h2>
        <p>Your AI-powered agricultural assistant</p>
    </div>
    <div class="card-grid">
        <div class="card">
            <div class="card-icon">
                <svg width="30" height="30" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            <h3>Upload Image</h3>
            <p>Take or upload a photo of the affected crop leaf for instant analysis</p>
        </div>
        <div class="card">
            <div class="card-icon">
                <svg width="30" height="30" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </div>
            <h3>Get Diagnosis</h3>
            <p>Receive instant AI-powered disease identification and severity assessment</p>
        </div>
        <div class="card">
            <div class="card-icon">
                <svg width="30" height="30" fill="none" stroke="white" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <h3>Follow Treatment</h3>
            <p>Implement recommended treatment steps in your preferred language</p>
        </div>
    </div>
    <div style="text-align: center; margin-top: 60px;">
        <form action="{{ url_for('kisan_bot') }}" method="POST" enctype="multipart/form-data" class="upload-form">
            <!-- Custom File Upload -->
            <div class="file-upload-container">
                <label for="crop-image" class="file-upload-label">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"/>
                    </svg>
                    <span id="file-label-text">Upload Crop Image</span>
                    <span class="file-upload-icon">üìÅ</span>
                </label>
                <input type="file" id="crop-image" name="crop-image" accept="image/*" required class="file-input">
            </div>

            <div class="text-input-container">
                <label for="query" class="input-label">
                    Ask a Question (Optional)
                </label>
                <input type="text" id="query" name="query" placeholder="E.g., What disease is this?" class="text-input">
            </div>
            
            <button type="submit" class="btn btn-primary btn-large">Start Diagnosis</button>
        </form>
        
        {% if diagnosis %}
        <div class="card diagnosis-card">
            <h3 style="font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; color: var(--text-primary); margin-bottom: 15px;">Diagnosis Result</h3>
            <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; border-left: 4px solid var(--primary);">
                <p style="color: var(--text-primary); line-height: 1.8; white-space: pre-wrap; margin: 0; font-size: 1.1rem;">{{ diagnosis }}</p>
            </div>
            {% if image_path %}
            <img src="{{ url_for('static', filename=image_path) }}" alt="Uploaded Crop Image" style="max-width: 100%; border-radius: 10px; margin-top: 20px; max-height: 300px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('crop-image');
    const fileLabel = document.querySelector('.file-upload-label');
    const fileLabelText = document.getElementById('file-label-text');
    
    fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const fileName = this.files[0].name;
            fileLabelText.textContent = fileName.length > 25 ? fileName.substring(0, 25) + '...' : fileName;
            fileLabel.classList.add('has-file');
        } else {
            fileLabelText.textContent = 'Upload Crop Image';
            fileLabel.classList.remove('has-file');
        }
    });
});
</script>
{% endblock %}